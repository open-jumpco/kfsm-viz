= KFSM Visualization

This project will explore many ways to visualize KFSM definitions.

This project require Kotlin Grammar Tools in order to parse the code containing the FSM.

I made changes to `https://github.com/Kotlin/grammar-tools` if the change had been merge the batch file change change to checkout
their version.

== Getting Started

[source,groovy]
-----
repositories {
    maven {
        url 'https://oss.sonatype.org/content/groups/public/'
    }
    mavenCentral()
}
dependencies {
    testImplementation 'io.jumpco.open:kfsm-viz:0.9.0-SNAPSHOT'
}
-----

You should implement a test method to generate the required statemachine model artifacts.

=== PlantUML Statemachine Diagram from StatemachineDefinition
By using the StateMachineDefinition created by the DSL we do not have access to the details of guard expressions or actions.

[source,kotlin]
----
@Test
fun produceVisualizationTurnstileFSM() {
    println("== TurnStile")
    val visualisation = visualize(TurnstileFSM.definition)
    File("generated", "turnstile.plantuml").writeText(plantUml(visualisation))
}
----

=== PlantUML Statemachine Diagram from VisualStatemachineDefinition
By parsing the source code we can extract the details of the guard expressions and actions.
This requires that you place one definition inside of one class.
There is a chance for the parser based solution to misbehave. We request that you log an issue with the problematic FSM definition.

[source,kotlin]
----
@Test
fun produceVisualizationTurnstileFSM() {
    println("== TurnStile")
    val visualisation = parseStateMachine("TurnstileFSM", File("src/test/kotlin/Turnstile.kt"))
    File("generated-parsed", "turnstile.plantuml").writeText(plantUml(visualisation))
}
----

=== AsciiDoctor State Table from VisualStatemachineDefinition

[source,kotlin]
----
@Test
fun produceVisualizationTurnstileFSM() {
    println("== TurnStile")
    val visualisation = parseStateMachine("TurnstileFSM", File("src/test/kotlin/Turnstile.kt"))
    File("generated-parsed", "turnstile.adoc").writeText(asciiDoc(visualisation))
}
----


== Generated from StateMachineDefinition.

=== Plantuml

==== Turnstile FSM

link:./src/test/kotlin/Turnstile.kt[Turnstile.kt]

image::turnstile.png[]

==== Paying Turnstile FSM

link:./src/test/kotlin/PayingTurnstile.kt[PayingTurnstile.kt]

image::paying_turnstile.png[]

==== Secure Turnstile FSM

link:./src/test/kotlin/SecureTurnstile.kt[SecureTurnstile.kt]

image::secure_turnstile.png[]

==== Packer Reader FSM

link:./src/test/kotlin/PacketReader.kt[PacketReader.kt]

image::packet_reader.png[]

== Generated from parsed VisualStateDefinition

We generated an asciidoc table as well as a plantuml statemachine model.

==== Turnstile FSM

link:./src/test/kotlin/Turnstile.kt[Turnstile.kt]

include::generated-parsed/turnstile.adoc[]

image::turnstile-parsed.png[]

==== Paying Turnstile FSM

link:./src/test/kotlin/PayingTurnstile.kt[PayingTurnstile.kt]

include::generated-parsed/paying-turnstile.adoc[]

image::paying_turnstile-parsed.png[]

==== Secure Turnstile FSM

link:./src/test/kotlin/SecureTurnstile.kt[SecureTurnstile.kt]

include::generated-parsed/secure-turnstile.adoc[]

image::secure_turnstile-parsed.png[]

==== Packer Reader FSM

link:./src/test/kotlin/PacketReader.kt[PacketReader.kt]

include::generated-parsed/packet-reader.adoc[]

image::packet_reader-parsed.png[]
